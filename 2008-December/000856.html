<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [OpenFDM-svn] r888 - branches/OpenFDM-StateSeparation/src/OpenFDM
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openfdm-svn/2008-December/index.html" >
   <LINK REL="made" HREF="mailto:openfdm-svn%40lists.berlios.de?Subject=Re%3A%20%5BOpenFDM-svn%5D%20r888%20-%20branches/OpenFDM-StateSeparation/src/OpenFDM&In-Reply-To=%3C200812251120.mBPBKI36032191%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000855.html">
   <LINK REL="Next"  HREF="000857.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[OpenFDM-svn] r888 - branches/OpenFDM-StateSeparation/src/OpenFDM</H1>
    <B>frohlich at BerliOS</B> 
    <A HREF="mailto:openfdm-svn%40lists.berlios.de?Subject=Re%3A%20%5BOpenFDM-svn%5D%20r888%20-%20branches/OpenFDM-StateSeparation/src/OpenFDM&In-Reply-To=%3C200812251120.mBPBKI36032191%40sheep.berlios.de%3E"
       TITLE="[OpenFDM-svn] r888 - branches/OpenFDM-StateSeparation/src/OpenFDM">frohlich at mail.berlios.de
       </A><BR>
    <I>Thu Dec 25 12:20:18 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000855.html">[OpenFDM-svn] r887 - in branches/OpenFDM-StateSeparation: .	src/OpenFDM src/test
</A></li>
        <LI>Next message: <A HREF="000857.html">[OpenFDM-svn] r889 - branches/OpenFDM-StateSeparation/src/OpenFDM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#856">[ date ]</a>
              <a href="thread.html#856">[ thread ]</a>
              <a href="subject.html#856">[ subject ]</a>
              <a href="author.html#856">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: frohlich
Date: 2008-12-25 12:20:17 +0100 (Thu, 25 Dec 2008)
New Revision: 888

Removed:
   branches/OpenFDM-StateSeparation/src/OpenFDM/PortId.h
Modified:
   branches/OpenFDM-StateSeparation/src/OpenFDM/Group.h
   branches/OpenFDM-StateSeparation/src/OpenFDM/GroupInterfaceNode.h
   branches/OpenFDM-StateSeparation/src/OpenFDM/Makefile.am
   branches/OpenFDM-StateSeparation/src/OpenFDM/Node.cpp
   branches/OpenFDM-StateSeparation/src/OpenFDM/Node.h
   branches/OpenFDM-StateSeparation/src/OpenFDM/RigidBody.cpp
   branches/OpenFDM-StateSeparation/src/OpenFDM/RigidBody.h
   branches/OpenFDM-StateSeparation/src/OpenFDM/SimpleDirectModel.cpp
   branches/OpenFDM-StateSeparation/src/OpenFDM/SimpleDirectModel.h
Log:
Retire PortId.

M    src/OpenFDM/Group.h
M    src/OpenFDM/Makefile.am
M    src/OpenFDM/RigidBody.h
M    src/OpenFDM/Node.h
M    src/OpenFDM/SimpleDirectModel.h
M    src/OpenFDM/RigidBody.cpp
M    src/OpenFDM/Node.cpp
M    src/OpenFDM/GroupInterfaceNode.h
D    src/OpenFDM/PortId.h
M    src/OpenFDM/SimpleDirectModel.cpp


Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/Group.h
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/Group.h	2008-12-24 09:05:27 UTC (rev 887)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/Group.h	2008-12-25 11:20:17 UTC (rev 888)
@@ -9,7 +9,6 @@
 #include &lt;vector&gt;
 #include &quot;Connect.h&quot;
 #include &quot;Node.h&quot;
-#include &quot;PortId.h&quot;
 #include &quot;PortInfo.h&quot;
 #include &quot;SharedPtr.h&quot;
 

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/GroupInterfaceNode.h
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/GroupInterfaceNode.h	2008-12-24 09:05:27 UTC (rev 887)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/GroupInterfaceNode.h	2008-12-25 11:20:17 UTC (rev 888)
@@ -12,7 +12,6 @@
 #include &quot;Node.h&quot;
 #include &quot;NodeVisitor.h&quot;
 #include &quot;Object.h&quot;
-#include &quot;PortId.h&quot;
 #include &quot;PortInfo.h&quot;
 #include &quot;SharedPtr.h&quot;
 

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/Makefile.am
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/Makefile.am	2008-12-24 09:05:27 UTC (rev 887)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/Makefile.am	2008-12-25 11:20:17 UTC (rev 888)
@@ -87,7 +87,6 @@
   OpenFDMConfig.h \
   PhysicalDimension.h \
   Plane.h \
-  PortId.h \
   PortInfo.h \
   PortValue.h \
   PortValueList.h \

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/Node.cpp
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/Node.cpp	2008-12-24 09:05:27 UTC (rev 887)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/Node.cpp	2008-12-25 11:20:17 UTC (rev 888)
@@ -103,10 +103,10 @@
   return false;
 }
 
-SharedPtr&lt;const PortInfo&gt;
-Node::getPort(const PortId&amp; portId) const
+unsigned
+Node::getNumPorts() const
 {
-  return portId._port.lock();
+  return mPortList.size();
 }
 
 SharedPtr&lt;const PortInfo&gt;
@@ -120,53 +120,34 @@
 SharedPtr&lt;const PortInfo&gt;
 Node::getPort(const std::string&amp; name) const
 {
-  return getPort(getPortId(name));
-}
-
-unsigned
-Node::getNumPorts() const
-{
-  return mPortList.size();
-}
-
-PortId
-Node::getPortId(unsigned index) const
-{
-  if (mPortList.size() &lt;= index)
-    return PortId();
-  return PortId(mPortList[index]);
-}
-
-PortId
-Node::getPortId(const std::string&amp; name) const
-{
   PortList::const_iterator i;
   for (i = mPortList.begin(); i != mPortList.end(); ++i) {
     if (name == (*i)-&gt;getName())
-      return PortId(*i);
-  }
-  return PortId();
+      return *i;
+   }
+  return 0;
 }
 
 unsigned
-Node::getPortIndex(const PortId&amp; portId) const
+Node::getPortIndex(const PortInfo* portInfo) const
 {
-  SharedPtr&lt;const PortInfo&gt; port = portId._port.lock();
-  if (!port)
-    return ~0u;
   PortList::const_iterator i;
-  i = std::find(mPortList.begin(), mPortList.end(), portId._port.lock());
-  if (i == mPortList.end())
-    return ~0u;
-  return port-&gt;getIndex();
+  for (i = mPortList.begin(); i != mPortList.end(); ++i) {
+    if (portInfo == i-&gt;get())
+      return std::distance(mPortList.begin(), i);
+  }
+  return ~0u;
 }
 
 bool
-Node::checkPort(const PortId&amp; portId) const
+Node::checkPort(const PortInfo* portInfo) const
 {
   PortList::const_iterator i;
-  i = std::find(mPortList.begin(), mPortList.end(), portId._port.lock());
-  return i != mPortList.end();
+  for (i = mPortList.begin(); i != mPortList.end(); ++i) {
+    if (portInfo == i-&gt;get())
+      return true;
+  }
+  return false;
 }
 
 class Node::CycleCheckVisitor : public ConstNodeVisitor {

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/Node.h
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/Node.h	2008-12-24 09:05:27 UTC (rev 887)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/Node.h	2008-12-25 11:20:17 UTC (rev 888)
@@ -8,7 +8,6 @@
 #include &lt;string&gt;
 #include &lt;vector&gt;
 #include &quot;Object.h&quot;
-#include &quot;PortId.h&quot;
 #include &quot;PortInfo.h&quot;
 #include &quot;SampleTime.h&quot;
 #include &quot;SharedPtr.h&quot;
@@ -43,17 +42,12 @@
   WeakPtr&lt;Node&gt; getParent(unsigned i);
   bool isChildOf(const Group* group) const;
 
-  SharedPtr&lt;const PortInfo&gt; getPort(const PortId&amp; portId) const;
+  unsigned getNumPorts() const;
   SharedPtr&lt;const PortInfo&gt; getPort(unsigned index) const;
   SharedPtr&lt;const PortInfo&gt; getPort(const std::string&amp; name) const;
+  unsigned getPortIndex(const PortInfo* portInfo) const;
+  bool checkPort(const PortInfo* portInfo) const;
 
-  unsigned getNumPorts() const;
-  PortId getPortId(unsigned index) const;
-  PortId getPortId(const std::string&amp; name) const;
-
-  unsigned getPortIndex(const PortId&amp; portId) const;
-  bool checkPort(const PortId&amp; portId) const;
-
   const SampleTime&amp; getSampleTime() const
   { return mSampleTime; }
   void setSampleTime(const SampleTime&amp; sampleTime)

Deleted: branches/OpenFDM-StateSeparation/src/OpenFDM/PortId.h
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/PortId.h	2008-12-24 09:05:27 UTC (rev 887)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/PortId.h	2008-12-25 11:20:17 UTC (rev 888)
@@ -1,37 +0,0 @@
-/* -*-c++-*- OpenFDM - Copyright (C) 2007-2008 Mathias Froehlich 
- *
- */
-
-#ifndef OpenFDM_PortId_H
-#define OpenFDM_PortId_H
-
-#include &quot;PortInfo.h&quot;
-#include &quot;SharedPtr.h&quot;
-#include &quot;WeakPtr.h&quot;
-
-namespace OpenFDM {
-
-// Forward decl for friends ...
-class Node;
-
-class PortId {
-public:
-  PortId() {}
-  // Hmm, FIXME, public??
-  PortId(const SharedPtr&lt;const PortInfo&gt;&amp; port) : _port(port) {}
-
-  bool operator==(const PortId&amp; other) const
-  { return _port == other._port; }
-  bool operator!=(const PortId&amp; other) const
-  { return _port != other._port; }
-  bool operator&lt;(const PortId&amp; other) const
-  { return _port &lt; other._port; }
-
-private:
-  friend class Node;
-  WeakPtr&lt;const PortInfo&gt; _port;
-};
-
-} // namespace OpenFDM
-
-#endif

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/RigidBody.cpp
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/RigidBody.cpp	2008-12-24 09:05:27 UTC (rev 887)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/RigidBody.cpp	2008-12-25 11:20:17 UTC (rev 888)
@@ -37,20 +37,22 @@
   visitor.handleNodePathAndApply(this);
 }
 
-PortId
+const PortInfo*
 RigidBody::addLink(const std::string&amp; name)
 {
+  // FIXME: simplify
   MechanicLink mechanicLink = newMechanicLink(name);
   mMechanicLinks.push_back(mechanicLink);
-  return getPortId(mechanicLink.getPortIndex());
+  return getPort(mechanicLink.getPortIndex());
 }
 
 void
-RigidBody::removeLink(const PortId&amp; portId)
+RigidBody::removeLink(const PortInfo* portInfo)
 {
+  // FIXME: simplify
   MechanicLinkVector::iterator i = mMechanicLinks.begin();
   while (i != mMechanicLinks.end()) {
-    if (getPortIndex(portId) == i-&gt;getPortIndex()) {
+    if (getPort(i-&gt;getPortIndex()) == portInfo) {
       i-&gt;clear();
       i = mMechanicLinks.erase(i);
     } else

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/RigidBody.h
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/RigidBody.h	2008-12-24 09:05:27 UTC (rev 887)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/RigidBody.h	2008-12-25 11:20:17 UTC (rev 888)
@@ -19,8 +19,8 @@
   virtual void accept(NodeVisitor&amp; visitor);
   virtual void accept(ConstNodeVisitor&amp; visitor) const;
 
-  PortId addLink(const std::string&amp; name);
-  void removeLink(const PortId&amp; portId);
+  const PortInfo* addLink(const std::string&amp; name);
+  void removeLink(const PortInfo* portInfo);
 
 private:
   typedef std::vector&lt;MechanicLink&gt; MechanicLinkVector;

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/SimpleDirectModel.cpp
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/SimpleDirectModel.cpp	2008-12-24 09:05:27 UTC (rev 887)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/SimpleDirectModel.cpp	2008-12-25 11:20:17 UTC (rev 888)
@@ -147,6 +147,26 @@
   return new Context(this, inputValues, outputPortValue);
 }
 
+unsigned
+SimpleDirectModel::getNumInputPorts() const
+{
+  return mInputPorts.size();
+}
+
+const InputPortInfo*
+SimpleDirectModel::getInputPort(unsigned i) const
+{
+  if (mInputPorts.size() &lt;= i)
+    return 0;
+  return mInputPorts[i];
+}
+
+const OutputPortInfo*
+SimpleDirectModel::getOutputPort() const
+{
+  return mOutputPort;
+}
+
 void
 SimpleDirectModel::setNumInputPorts(unsigned numInputPorts)
 {
@@ -160,19 +180,19 @@
     removeInputPort(getInputPort(oldnum-1));
 }
 
-PortId
+const InputPortInfo*
 SimpleDirectModel::addInputPort(const std::string&amp; name)
 {
   mInputPorts.push_back(new InputPortInfo(this, name, Size(0, 0), true));
-  return PortId(mInputPorts.back());
+  return mInputPorts.back();
 }
 
 void
-SimpleDirectModel::removeInputPort(const PortId&amp; portId)
+SimpleDirectModel::removeInputPort(const InputPortInfo* portInfo)
 {
   InputPortVector::iterator i = mInputPorts.begin();
   while (i != mInputPorts.end()) {
-    if (portId != PortId(*i)) {
+    if (portInfo != i-&gt;get()) {
       ++i;
       continue;
     }

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/SimpleDirectModel.h
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/SimpleDirectModel.h	2008-12-24 09:05:27 UTC (rev 887)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/SimpleDirectModel.h	2008-12-25 11:20:17 UTC (rev 888)
@@ -19,17 +19,6 @@
   SimpleDirectModel(const std::string&amp; name);
   virtual ~SimpleDirectModel();
 
-  unsigned getNumInputPorts() const
-  { return mInputPorts.size(); }
-  PortId getInputPort(unsigned i) const
-  {
-    if (mInputPorts.size() &lt;= i)
-      return PortId();
-    return PortId(mInputPorts[i]);
-  }
-  PortId getOutputPort() const
-  { return PortId(mOutputPort); }
-
   class Context;
   virtual AbstractModelContext* newModelContext(PortValueList&amp; portValueList) const;
   virtual void output(Context&amp; context) const = 0;
@@ -66,10 +55,14 @@
     SharedPtr&lt;NumericPortValue&gt; mOutputValue;
   };
 
+  unsigned getNumInputPorts() const;
+  const InputPortInfo* getInputPort(unsigned i) const;
+  const OutputPortInfo* getOutputPort() const;
+
 protected:
   void setNumInputPorts(unsigned numInputPorts);
-  PortId addInputPort(const std::string&amp; name);
-  void removeInputPort(const PortId&amp; portId);
+  const InputPortInfo* addInputPort(const std::string&amp; name);
+  void removeInputPort(const InputPortInfo* portInfo);
 
 private:
   typedef std::vector&lt;SharedPtr&lt;InputPortInfo&gt; &gt; InputPortVector;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000855.html">[OpenFDM-svn] r887 - in branches/OpenFDM-StateSeparation: .	src/OpenFDM src/test
</A></li>
	<LI>Next message: <A HREF="000857.html">[OpenFDM-svn] r889 - branches/OpenFDM-StateSeparation/src/OpenFDM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#856">[ date ]</a>
              <a href="thread.html#856">[ thread ]</a>
              <a href="subject.html#856">[ subject ]</a>
              <a href="author.html#856">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openfdm-svn">More information about the OpenFDM-svn
mailing list</a><br>
</body></html>
