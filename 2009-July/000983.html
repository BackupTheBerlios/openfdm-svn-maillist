<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [OpenFDM-svn] r1005 - branches/OpenFDM-StateSeparation/src/OpenFDM
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openfdm-svn/2009-July/index.html" >
   <LINK REL="made" HREF="mailto:openfdm-svn%40lists.berlios.de?Subject=Re%3A%20%5BOpenFDM-svn%5D%20r1005%20-%20branches/OpenFDM-StateSeparation/src/OpenFDM&In-Reply-To=%3C200907150521.n6F5LXWB005086%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000967.html">
   <LINK REL="Next"  HREF="000968.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[OpenFDM-svn] r1005 - branches/OpenFDM-StateSeparation/src/OpenFDM</H1>
    <B>frohlich at BerliOS</B> 
    <A HREF="mailto:openfdm-svn%40lists.berlios.de?Subject=Re%3A%20%5BOpenFDM-svn%5D%20r1005%20-%20branches/OpenFDM-StateSeparation/src/OpenFDM&In-Reply-To=%3C200907150521.n6F5LXWB005086%40sheep.berlios.de%3E"
       TITLE="[OpenFDM-svn] r1005 - branches/OpenFDM-StateSeparation/src/OpenFDM">frohlich at mail.berlios.de
       </A><BR>
    <I>Wed Jul 15 07:21:33 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000967.html">[OpenFDM-svn] r1004 - branches/OpenFDM-StateSeparation/src/OpenFDM
</A></li>
        <LI>Next message: <A HREF="000968.html">[OpenFDM-svn] r1006 - branches/OpenFDM-StateSeparation/src/OpenFDM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#983">[ date ]</a>
              <a href="thread.html#983">[ thread ]</a>
              <a href="subject.html#983">[ subject ]</a>
              <a href="author.html#983">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: frohlich
Date: 2009-07-15 07:21:29 +0200 (Wed, 15 Jul 2009)
New Revision: 1005

Removed:
   branches/OpenFDM-StateSeparation/src/OpenFDM/Frame.h
Modified:
   branches/OpenFDM-StateSeparation/src/OpenFDM/AeroForce.cpp
   branches/OpenFDM-StateSeparation/src/OpenFDM/AeroForce.h
   branches/OpenFDM-StateSeparation/src/OpenFDM/CartesianJoint.h
   branches/OpenFDM-StateSeparation/src/OpenFDM/Contact.cpp
   branches/OpenFDM-StateSeparation/src/OpenFDM/CoordinateSystem.h
   branches/OpenFDM-StateSeparation/src/OpenFDM/ExternalInteract.cpp
   branches/OpenFDM-StateSeparation/src/OpenFDM/FixedRootJoint.cpp
   branches/OpenFDM-StateSeparation/src/OpenFDM/HDF5SystemOutput.h
   branches/OpenFDM-StateSeparation/src/OpenFDM/InternalInteract.cpp
   branches/OpenFDM-StateSeparation/src/OpenFDM/Launchbar.cpp
   branches/OpenFDM-StateSeparation/src/OpenFDM/Launchbar.h
   branches/OpenFDM-StateSeparation/src/OpenFDM/Makefile.am
   branches/OpenFDM-StateSeparation/src/OpenFDM/Mass.cpp
   branches/OpenFDM-StateSeparation/src/OpenFDM/MechanicLinkValue.cpp
   branches/OpenFDM-StateSeparation/src/OpenFDM/MechanicLinkValue.h
   branches/OpenFDM-StateSeparation/src/OpenFDM/MobileRootJoint.cpp
   branches/OpenFDM-StateSeparation/src/OpenFDM/PacejkaTire.cpp
   branches/OpenFDM-StateSeparation/src/OpenFDM/Tailhook.cpp
   branches/OpenFDM-StateSeparation/src/OpenFDM/Tailhook.h
   branches/OpenFDM-StateSeparation/src/OpenFDM/WheelContact.cpp
Log:
Remove Frame from MechanicLinkValue.
Introduce new values for the velocities and accelerations.
Remove Frame.h.


Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/AeroForce.cpp
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/AeroForce.cpp	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/AeroForce.cpp	2009-07-15 05:21:29 UTC (rev 1005)
@@ -6,7 +6,6 @@
 
 #include &quot;Object.h&quot;
 #include &quot;Vector.h&quot;
-#include &quot;Frame.h&quot;
 #include &quot;Force.h&quot;
 #include &quot;Atmosphere.h&quot;
 

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/AeroForce.h
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/AeroForce.h	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/AeroForce.h	2009-07-15 05:21:29 UTC (rev 1005)
@@ -8,7 +8,6 @@
 #include &quot;Assert.h&quot;
 #include &quot;Object.h&quot;
 #include &quot;Vector.h&quot;
-#include &quot;Frame.h&quot;
 #include &quot;Force.h&quot;
 #include &quot;Atmosphere.h&quot;
 #include &quot;Ground.h&quot;

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/CartesianJoint.h
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/CartesianJoint.h	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/CartesianJoint.h	2009-07-15 05:21:29 UTC (rev 1005)
@@ -143,7 +143,7 @@
       mChildLink.setCoordinateSystem(mParentLink.getCoordinateSystem().toReference(mRelativeCoordinateSystem));
 
       Vector6 relVel = mJointMatrix*velocity;
-      mChildLink.setPosAndVel(mParentLink, relPosition, orientation, relVel);
+      mChildLink.setRelativeVelocity(mParentLink, relVel);
 
       /**
          This is the cross product of the inertial spatial velocity
@@ -155,7 +155,7 @@
          transformed spatial velocity of the parent frame cross the
          relative velocity.
       */
-      Vector6 pivel = mParentLink.getSpVelAtLink();
+      Vector6 pivel = mParentLink.getLocalVelocityAtLink();
       pivel = mRelativeCoordinateSystem.motionToLocal(pivel);
       mHdot = Vector6(cross(pivel.getAngular(), relVel.getAngular()),
                       cross(pivel.getAngular(), relVel.getLinear()) + 
@@ -215,12 +215,14 @@
       if (hIh.singular())
         return;
 
-      Vector6 parentSpAccel = mParentLink.getSpAccelAtLink();
+      Vector6 parentSpAccel = mParentLink.getLocalAccelerationAtLink();
       parentSpAccel = mRelativeCoordinateSystem.motionToLocal(parentSpAccel);
 
       Vector6 f = mChildLink.getInertia()*parentSpAccel + pAlpha;
       mVelDot = hIh.solve(mJointForce - trans(mJointMatrix)*f);
-      mChildLink.setAccel(mParentLink, mJointMatrix*mVelDot);
+
+      Vector6 spAccel = parentSpAccel + getHdot() + mJointMatrix*mVelDot;
+      mChildLink.setLocalAcceleration(spAccel);
     }
   
     /** Compute the articulation step for a given velocity derivative.
@@ -251,7 +253,11 @@
      */
     void accelerateDueToVelDot()
     {
-      mChildLink.setAccel(mParentLink, mJointMatrix*mVelDot);
+      Vector6 parentSpAccel = mParentLink.getLocalAccelerationAtLink();
+      parentSpAccel = mRelativeCoordinateSystem.motionToLocal(parentSpAccel);
+
+      Vector6 spAccel = parentSpAccel + getHdot() + mJointMatrix*mVelDot;
+      mChildLink.setLocalAcceleration(spAccel);
     }
 
     const VectorN&amp; getVelDot() const

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/Contact.cpp
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/Contact.cpp	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/Contact.cpp	2009-07-15 05:21:29 UTC (rev 1005)
@@ -49,7 +49,7 @@
     // The velocity of the ground patch in the current frame.
     Vector3 relVel = groundValues.vel.getLinear();
     // Now get the relative velocity of the ground wrt the contact point
-    relVel -= getLink().getRefVel().getLinear();
+    relVel -= getLink().getLocalVelocity().getLinear();
 
     
     // The velocity perpandicular to the plane.

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/CoordinateSystem.h
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/CoordinateSystem.h	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/CoordinateSystem.h	2009-07-15 05:21:29 UTC (rev 1005)
@@ -30,10 +30,18 @@
     mPosition(Vector3::zeros()),
     mOrientation(orientation)
   { }
+  CoordinateSystem(const Rotation&amp; orientation) :
+    mPosition(Vector3::zeros()),
+    mOrientation(orientation)
+  { }
   CoordinateSystem(const Vector3&amp; position, const Quaternion&amp; orientation) :
     mPosition(position),
     mOrientation(orientation)
   { }
+  CoordinateSystem(const Vector3&amp; position, const Rotation&amp; orientation) :
+    mPosition(position),
+    mOrientation(orientation)
+  { }
   CoordinateSystem(const CoordinateSystem&amp; coordinateSystem) :
     mPosition(coordinateSystem.mPosition),
     mOrientation(coordinateSystem.mOrientation)
@@ -102,11 +110,14 @@
                    mOrientation.transform(v.getLinear())); }
 
 
+  // Avoid that here. We *only* handle coordinate systems not reference frames.
   Vector6 motionToReference(const Vector6&amp; motion) const
   { return motionFrom(mPosition, mOrientation, motion); }
   Vector6 motionToLocal(const Vector6&amp; motion) const
   { return motionTo(mPosition, mOrientation, motion); }
 
+  // Hmm force and inertia have this cross product stuff also,
+  // is that something reference frame related or not ???
   Vector6 forceToReference(const Vector6&amp; force) const
   { return forceFrom(mPosition, mOrientation, force); }
   Vector6 forceToLocal(const Vector6&amp; force) const

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/ExternalInteract.cpp
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/ExternalInteract.cpp	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/ExternalInteract.cpp	2009-07-15 05:21:29 UTC (rev 1005)
@@ -90,7 +90,7 @@
     if (enableBodyAngularVelocity || enableBodyLinearVelocity
         || enableGlobalAngularVelocity || enableGlobalLinearVelocity
         || enableBodyWindVelocity || enableGlobalWindVelocity) {
-      Vector6 refVelocity = getLink().getRefVel();
+      Vector6 refVelocity = getLink().getLocalVelocity();
       if (enableBodyAngularVelocity)
         mBodyAngularVelocity = refVelocity.getAngular();
       if (enableGlobalAngularVelocity)
@@ -170,8 +170,8 @@
       = mBodyCentrifugalAcceleration.isConnected();
     bool enableBodyLoad = mBodyLoad.isConnected();
     if (enableBodyCentrifugalAcceleration || enableBodyLoad) {
-      Vector6 spatialVel = getLink().getSpVel();
-      Vector6 spatialAccel = getLink().getSpAccel();
+      Vector6 spatialVel = getLink().getLocalVelocity();
+      Vector6 spatialAccel = getLink().getLocalAcceleration();
       Vector3 centrifugalAccel = spatialAccel.getLinear();
       centrifugalAccel += cross(spatialVel.getAngular(),spatialVel.getLinear());
 

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/FixedRootJoint.cpp
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/FixedRootJoint.cpp	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/FixedRootJoint.cpp	2009-07-15 05:21:29 UTC (rev 1005)
@@ -43,16 +43,14 @@
     CoordinateSystem coordSys(mFixedRootJoint-&gt;mRootPosition,
                               mFixedRootJoint-&gt;mRootOrientation);
     mChildLink.setCoordinateSystem(coordSys);
-    mChildLink.setPosAndVel(angularVel, mFixedRootJoint-&gt;mRootPosition,
-                            mFixedRootJoint-&gt;mRootOrientation,
-                            Vector6::zeros());
+    mChildLink.setBaseVelocity(angularVel, Vector6::zeros());
   }
   virtual void accelerations(const Task&amp; task)
   {
+    // FIXME
     Vector6 spAccel = getEnvironment().getAcceleration(task.getTime());
-    spAccel = motionTo(mFixedRootJoint-&gt;mRootPosition,
-                       mFixedRootJoint-&gt;mRootOrientation, spAccel);
-    mChildLink.setSpAccel(spAccel);
+    spAccel = motionTo(mFixedRootJoint-&gt;mRootPosition, spAccel);
+    mChildLink.setAcceleration(spAccel);
   }
   
 private:

Deleted: branches/OpenFDM-StateSeparation/src/OpenFDM/Frame.h
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/Frame.h	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/Frame.h	2009-07-15 05:21:29 UTC (rev 1005)
@@ -1,420 +0,0 @@
-/* -*-c++-*- OpenFDM - Copyright (C) 2004-2009 Mathias Froehlich 
- *
- */
-
-#ifndef OpenFDM_Frame_H
-#define OpenFDM_Frame_H
-
-#include &quot;Assert.h&quot;
-#include &quot;Vector.h&quot;
-#include &quot;Plane.h&quot;
-#include &quot;Transform.h&quot;
-#include &quot;Matrix.h&quot;
-#include &quot;Quaternion.h&quot;
-#include &quot;Rotation.h&quot;
-
-namespace OpenFDM {
-
-/** 
-The \ref Frame class is the basic tool to model a tree of moving and
-accelerating coordinate frames.
-*/
-
-class Frame {
-public:
-  Frame() :
-    mPosition(Vector3::zeros()),
-    mOrientation(Quaternion::unit()),
-    mRelVel(Vector6::zeros()),
-    mRelVelDot(Vector6::zeros()),
-    mParentSpVel(Vector6::zeros()),
-    mParentSpAccel(Vector6::zeros()),
-    mRefOrient(Quaternion::unit()),
-    mRefPos(Vector3::zeros()),
-    mRefVel(Vector6::zeros())
-  { }
-  ~Frame(void)
-  { }
-
-  void setPosAndVel(const Frame&amp; parent)
-  {
-    mPosition = Vector3::zeros();
-    mOrientation = Quaternion::unit();
-    mRelVel = Vector6::zeros();
-
-    mRefOrient = parent.getRefOrientation();
-    mRefPos = parent.getRefPosition();
-    mRefVel = parent.getRefVel();
-
-    mParentSpVel = parent.getSpVel();
-  }
-
-  void setAccel(const Frame&amp; parent)
-  {
-    mRelVelDot = Vector6::zeros();
-    mParentSpAccel = parent.getSpAccel();
-  }
-
-  void setPosAndVel(const Frame&amp; parent, const Vector3&amp; position,
-                    const Quaternion&amp; orientation, const Vector6&amp; velocity)
-  {
-    mPosition = position;
-    mOrientation = orientation;
-    mRelVel = velocity;
-
-    mRefOrient = parent.getRefOrientation()*getOrientation();
-    mRefPos = parent.posToRef(getPosition());
-    mRefVel = velocity + motionFromParent(parent.getRefVel());
-
-    mParentSpVel = motionFromParent(parent.getSpVel());
-  }
-
-  void setAccel(const Frame&amp; parent, const Vector6&amp; acceleration)
-  {
-    mRelVelDot = acceleration;
-    mParentSpAccel = motionFromParent(parent.getSpAccel());
-  }
-
-  void setPosAndVel(const Vector3&amp; parentAngularVel, const Vector3&amp; position,
-                    const Quaternion&amp; orientation, const Vector6&amp; velocity)
-  {
-    mPosition = position;
-    mOrientation = orientation;
-    mRelVel = velocity;
-
-    mRefOrient = orientation;
-    mRefPos = position;
-
-    mParentSpVel = angularMotionTo(mPosition, mOrientation, parentAngularVel);
-    mRefVel = velocity + mParentSpVel;
-  }
-
-  void setAccel(const Vector6&amp; acceleration)
-  {
-    mRelVelDot = acceleration;
-    mParentSpAccel = Vector6::zeros();
-  }
-
-  void setSpAccel(const Vector6&amp; spatialAcceleration)
-  {
-    mParentSpAccel = Vector6::zeros();
-    mRelVelDot = spatialAcceleration - mParentSpAccel - getHdot();
-  }
-  void setSpAccel(const Frame&amp; parent, const Vector6&amp; spatialAcceleration)
-  {
-    mParentSpAccel = motionFromParent(parent.getSpAccel());
-    mRelVelDot = spatialAcceleration - mParentSpAccel - getHdot();
-  }
-
-  /** Position of the current frame.
-      @return The position vector of the current frame with repsect to the
-      parent frame. It is the only vector which is in the parent frames
-      coordinates.
-   */
-  const Vector3&amp; getPosition(void) const
-  { return mPosition; }
-
-  /** Orientation of the current frame.
-      @return The orientation of the current frame with repsect to the
-      parent frame. The quaternion returned here rotates vectors in the parent
-      frames coordinated to vectors in current frames coordinates.
-   */
-  const Rotation&amp; getOrientation(void) const
-  { return mOrientation; }
-
-
-  /** Rotation to parent frames coordinates.
-      @param v Vector in current frames coordinates to rotate to parent
-               frames coordinates.
-      @return  The vector v in the parent frames coordinates.
-   */
-  Vector3 rotToParent(const Vector3&amp; v) const
-  { return getOrientation().backTransform(v); }
-
-  /** Rotation to current frames coordinates.
-      @param v Vector in parent frames coordinates to rotate to current
-               frames coordinates.
-      @return  The vector v in the current frames coordinates.
-   */
-  Vector3 rotFromParent(const Vector3&amp; v) const
-  { return getOrientation().transform(v); }
-
-
-  /** Relative spatial velocity.
-      @return The spatial velocity vector of the current frame with respect
-              to the parent frame. The velocity is in the current frames
-              coordinates.
-   */
-  const Vector6&amp; getRelVel(void) const
-  { return mRelVel; }
-
-  /** Relative spatial acceleration.
-      @return The spatial acceleration vector of the current frame with respect
-              to the parent frame. The velocity is in the current frames
-              coordinates.
-   */
-  const Vector6&amp; getRelVelDot(void) const 
-  { return mRelVelDot; }
-
-
-  /** Linear velocity with respect to parent.
-      @return The linear velocity of this frame with respect to the parent
-      frame.
-   */
-  Vector3 getLinearRelVel(void) const
-  { return getRelVel().getLinear(); }
-
-  /** Angular velocity with respect to parent.
-      @return The angular velocity of this frame with respect to the parent
-      frame.
-   */
-  Vector3 getAngularRelVel(void) const
-  { return getRelVel().getAngular(); }
-
-  /** Spatial velocity of the parent frame.
-      @return The spatial velocity of the parent frame with respect to an
-      inertial frame transformed to the current frame. If the current frame
-      does not have a parent it is assumed to be an inertial frame.
-   */
-  const Vector6&amp; getParentSpVel(void) const
-  { return mParentSpVel; }
-
-  /** Spatial velocity of the current frame.
-      @return The spatial velocity of the current frame with respect to an
-      inertial frame. If the current frame does not have a parent it is
-      assumed to be an inertial frame.
-   */
-  Vector6 getSpVel(void) const
-  { return getRelVel() + getParentSpVel(); }
-
-  const Vector6&amp; getRefVel(void) const
-  { return mRefVel; }
-
-  /** Linear acceleration with respect to parent.
-      @return The linear acceleration of this frame with respect to the parent
-      frame.
-   */
-  Vector3 getLinearRelVelDot(void) const
-  { return getRelVelDot().getLinear(); }
-
-  /** Angular acceleration with respect to parent.
-      @return The angular acceleration of this frame with respect to the parent
-      frame.
-   */
-  Vector3 getAngularRelVelDot(void) const
-  { return getRelVelDot().getAngular(); }
-
-  /** Spatial acceleration of the parent frame.
-      @return The spatial acceleration of the parent frame with respect to an
-      inertial frame transformed to the current frame. If the current frame
-      does not have a parent it is assumed to be an inertial frame.
-      Note that the spatial acceleration is not the classical acceleration
-      of the moving and accelerating body (@see getClassicAccel).
-   */
-  const Vector6&amp; getParentSpAccel(void) const
-  { return mParentSpAccel; }
-
-  /** Spatial acceleration of the current frame.
-      @return The spatial acceleration of the current frame with respect to an
-      inertial frame. If the current frame does not have a parent it is
-      assumed to be an inertial frame.
-      Note that the spatial acceleration is not the classical acceleration
-      of the moving and accelerating body (@see getClassicAccel).
-   */
-  Vector6 getSpAccel(void) const
-  { return getRelVelDot() + getParentSpAccel() + getHdot(); }
-
-  /** Classical acceleration of the current frame.
-      @return The sensed acceleration of the current frame with respect to an
-      inertial frame. If the current frame does not have a parent it is
-      assumed to be an inertial frame.
-   */
-  Vector6 getClassicAccel(void) const
-  {
-    Vector6 iv = getSpVel();
-    return getRelVelDot() + getParentSpAccel() + getHdot()
-      + Vector6(Vector3::zeros(), cross(iv.getAngular(), iv.getLinear()));
-  }
-
-
-  /** FIXME belongs into the joints.
-   */
-  Vector6 getHdot(void) const
-  {
-    /**
-       This is the cross product of the inertial spatial velocity
-       vector with the relative spatial velocity vector (motion type
-       cross product). Since the inertial velocity is the transformed
-       inertial velocity of the parent frame plus the relative
-       velocity of the current frame, all the relative velocity
-       components cancel out in this expression. What remains is the
-       transformed spatial velocity of the parent frame cross the
-       relative velocity.
-     */
-    Vector6 pivel = getParentSpVel();
-    return Vector6(cross(pivel.getAngular(), getAngularRelVel()),
-                   cross(pivel.getAngular(), getLinearRelVel()) + 
-                   cross(pivel.getLinear(), getAngularRelVel()));
-  }
-
-  /** Position vector transform.
-      Transforms a position vector from the parent frame to the current
-      frame.
-      @param v The position vector in the parent frame to be transformed.
-      @return  The motion vector transformed to the current frame.
-   */
-  Vector3 posFromParent(const Vector3&amp; v) const
-  { return posTo(getPosition(), getOrientation(), v); }
-
-  /** Position vector transform.
-      Transforms a position vector from the current frame to the parent
-      frame.
-      @param v The position in the current frame to be transformed.
-      @return  The position transformed to the parent frame.
-   */
-  Vector3 posToParent(const Vector3&amp; v) const
-  { return posFrom(getPosition(), getOrientation(), v); }
-
-  /** Spatial motion vector transform.
-      Transforms a spatial motion vector from the parent frame to the current
-      frame.
-      @param v The motion vector in the parent frame to be transformed.
-      @return  The motion vector transformed to the current frame.
-   */
-  Vector6 motionFromParent(const Vector6&amp; v) const
-  { return motionTo(getPosition(), getOrientation(), v); }
-
-  /** Spatial motion vector transform.
-      Transforms a spatial motion vector from the current frame to the parent
-      frame.
-      @param v The motion vector in the current frame to be transformed.
-      @return  The motion vector transformed to the parent frame.
-   */
-  Vector6 motionToParent(const Vector6&amp; v) const
-  { return motionFrom(getPosition(), getOrientation(), v); }
-
-  /** Spatial force vector transform.
-      Transforms a spatial force vector from the parent frame to the current
-      frame.
-      @param v The force vector in the parent frame to be transformed.
-      @return  The force vector transformed to the current frame.
-   */
-  Vector6 forceFromParent(const Vector6&amp; v) const
-  { return forceTo(getPosition(), getOrientation(), v); }
-
-  /** Spatial force vector transform.
-      Transforms a spatial force vector from the current frame to the parent
-      frame.
-      @param v The force vector in the current frame to be transformed.
-      @return  The force vector transformed to the parent frame.
-   */
-  Vector6 forceToParent(const Vector6&amp; v) const
-  { return forceFrom(getPosition(), getOrientation(), v); }
-
-  Plane planeFromParent(const Plane&amp; plane) const
-  { return planeTo(getPosition(), getOrientation(), plane); }
-
-  Plane planeToParent(const Plane&amp; plane) const
-  { return planeFrom(getPosition(), getOrientation(), plane); }
-
-  /** Rotation to reference frames coordinates.
-      @param v Vector in current frames coordinates to rotate to reference
-               frames coordinates.
-      @return  The vector v in the reference frames coordinates.
-   */
-  Vector3 rotToRef(const Vector3&amp; v) const
-  { return getRefOrientation().backTransform(v); }
-
-  /** Rotation from reference frames coordinates.
-      @param v Vector in reference frames coordinates to rotate to current
-               frames coordinates.
-      @return  The vector v in the current frames coordinates.
-   */
-  Vector3 rotFromRef(const Vector3&amp; v) const
-  { return getRefOrientation().transform(v); }
-
-
-  /** Position vector transform.
-      Transforms a position vector from the reference frame to the current
-      frame.
-      @param v The position vector in the reference frame to be transformed.
-      @return  The motion vector transformed to the current frame.
-   */
-  Vector3 posFromRef(const Vector3&amp; v) const
-  { return posTo(getRefPosition(), getRefOrientation(), v); }
-
-  /** Position vector transform.
-      Transforms a position vector from the current frame to the reference
-      frame.
-      @param v The position in the current frame to be transformed.
-      @return  The position transformed to the reference frame.
-   */
-  Vector3 posToRef(const Vector3&amp; v) const
-  { return posFrom(getRefPosition(), getRefOrientation(), v); }
-
-
-  /** Spatial motion vector transform.
-      Transforms a spatial motion vector from the parent frame to the current
-      frame.
-      @param v The motion vector in the parent frame to be transformed.
-      @return  The motion vector transformed to the current frame.
-   */
-  Vector6 motionFromRef(const Vector6&amp; v) const
-  { return motionTo(getRefPosition(), getRefOrientation(), v); }
-
-  /** Spatial motion vector transform.
-      Transforms a spatial motion vector from the current frame to the parent
-      frame.
-      @param v The motion vector in the current frame to be transformed.
-      @return  The motion vector transformed to the parent frame.
-   */
-  Vector6 motionToRef(const Vector6&amp; v) const
-  { return motionFrom(getRefPosition(), getRefOrientation(), v); }
-
-  Plane planeFromRef(const Plane&amp; plane) const
-  { return planeTo(getRefPosition(), getRefOrientation(), plane); }
-
-  Plane planeToRef(const Plane&amp; plane) const
-  { return planeFrom(getRefPosition(), getRefOrientation(), plane); }
-
-  /** Reference orientation.
-   * Returns the reference orientation of this frame wrt the topmost frame 
-   * this frame is attached to.
-   * It is measured in the topmost frames coordinates.
-   */
-  const Quaternion&amp; getRefOrientation(void) const
-  { return mRefOrient; }
-
-  /** Reference position.
-   * Returns the reference position of this frame wrt the topmost frame 
-   * this frame is attached to.
-   * It is measured in the topmost frames coordinates.
-   */
-  const Vector3&amp; getRefPosition(void) const
-  { return mRefPos; }
-
-private:
-  // The offset of this frames origin wrt the parent frame measured in
-  // the parent frames coordinates.
-  Vector3 mPosition;
-  // The orientation wrt the parent frame (measured in the parent frames
-  Rotation mOrientation;
-
-  // The spatial velocity wrt parent frame measured in
-  // this frames coordinates.
-  // True? more the relative velocity ...
-  Vector6 mRelVel;
-
-  Vector6 mRelVelDot;
-
-  Vector6 mParentSpVel;
-  Vector6 mParentSpAccel;
-
-  Quaternion mRefOrient;
-  Vector3 mRefPos;
-  Vector6 mRefVel;
-};
-
-} // namespace OpenFDM
-
-#endif

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/HDF5SystemOutput.h
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/HDF5SystemOutput.h	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/HDF5SystemOutput.h	2009-07-15 05:21:29 UTC (rev 1005)
@@ -349,7 +349,6 @@
       _orientation(_group, &quot;orientation&quot;, Size(4, 1)),
       _eulerAngle(_group, &quot;eulerAngles&quot;, Size(3, 1)),
       _velocity(_group, &quot;velocity&quot;, Size(6, 1)),
-      _refVelocity(_group, &quot;refVelocity&quot;, Size(6, 1)),
       _acceleration(_group, &quot;acceleration&quot;, Size(6, 1)),
       _force(_group, &quot;force&quot;, Size(6, 1)),
       _inertia(_group, &quot;inertia&quot;, Size(6, 6))
@@ -360,9 +359,8 @@
       _position.append(cs.getPosition());
       _orientation.append(cs.getOrientation());
       _eulerAngle.append(cs.getOrientation().getEuler());
-      _velocity.append(mMechanicLinkValue-&gt;getSpVel());
-      _refVelocity.append(mMechanicLinkValue-&gt;getReferenceVelocity());
-      _acceleration.append(mMechanicLinkValue-&gt;getSpAccel());
+      _velocity.append(mMechanicLinkValue-&gt;getLocalVelocity());
+      _acceleration.append(mMechanicLinkValue-&gt;getLocalAcceleration());
       _force.append(mMechanicLinkValue-&gt;getForce());
       _inertia.append(mMechanicLinkValue-&gt;getInertia());
     }
@@ -375,7 +373,6 @@
     HDFMatrixStream _orientation;
     HDFMatrixStream _eulerAngle;
     HDFMatrixStream _velocity;
-    HDFMatrixStream _refVelocity;
     HDFMatrixStream _acceleration;
     HDFMatrixStream _force;
     HDFMatrixStream _inertia;

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/InternalInteract.cpp
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/InternalInteract.cpp	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/InternalInteract.cpp	2009-07-15 05:21:29 UTC (rev 1005)
@@ -58,9 +58,9 @@
 
     if (mVelocityValue.isConnected()) {
       // The motion of link1 measured in link0
-      Vector6 relVel = mRelCoordSys.motionToReference(getLink1().getRefVel());
+      Vector6 relVel = mRelCoordSys.motionToReference(getLink1().getLocalVelocity());
       // The relative motion of link1 wrt link0 measured in link0
-      relVel -= getLink0().getRefVel();
+      relVel -= getLink0().getLocalVelocity();
       // The scalar product is what we need.
       // Here the additional cross product term cancels out
       mVelocityValue = dot(mDirection, relVel.getLinear());

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/Launchbar.cpp
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/Launchbar.cpp	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/Launchbar.cpp	2009-07-15 05:21:29 UTC (rev 1005)
@@ -8,7 +8,6 @@
 #include &quot;LogStream.h&quot;
 #include &quot;Object.h&quot;
 #include &quot;Vector.h&quot;
-#include &quot;Frame.h&quot;
 #include &quot;Force.h&quot;
 
 namespace OpenFDM {

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/Launchbar.h
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/Launchbar.h	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/Launchbar.h	2009-07-15 05:21:29 UTC (rev 1005)
@@ -8,7 +8,6 @@
 #include &quot;Assert.h&quot;
 #include &quot;Object.h&quot;
 #include &quot;Vector.h&quot;
-#include &quot;Frame.h&quot;
 #include &quot;Force.h&quot;
 #include &quot;Ground.h&quot;
 #include &quot;Environment.h&quot;

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/Makefile.am
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/Makefile.am	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/Makefile.am	2009-07-15 05:21:29 UTC (rev 1005)
@@ -38,7 +38,6 @@
   ExplicitEuler.h \
   FlatPlanet.h \
   Fraction.h \
-  Frame.h \
   Function.h \
   Group.h \
   GroupInterfaceNode.h \

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/Mass.cpp
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/Mass.cpp	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/Mass.cpp	2009-07-15 05:21:29 UTC (rev 1005)
@@ -43,7 +43,7 @@
 
     // Each inertia has a contribution to the spatial bias force.
     // This part is handled here.
-    Vector6 v = getLink().getSpVelAtLink();
+    Vector6 v = getLink().getLocalVelocityAtLink();
     Vector6 Iv = mSpatialInertia*v;
     Vector6 vIv = Vector6(cross(v.getAngular(), Iv.getAngular()) +
                           cross(v.getLinear(), Iv.getLinear()),

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/MechanicLinkValue.cpp
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/MechanicLinkValue.cpp	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/MechanicLinkValue.cpp	2009-07-15 05:21:29 UTC (rev 1005)
@@ -16,4 +16,16 @@
 {
 }
 
+MechanicLinkValue*
+MechanicLinkValue::toMechanicLinkValue()
+{
+  return this;
+}
+
+const MechanicLinkValue*
+MechanicLinkValue::toMechanicLinkValue() const
+{
+  return this;
+}
+
 } // namespace OpenFDM

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/MechanicLinkValue.h
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/MechanicLinkValue.h	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/MechanicLinkValue.h	2009-07-15 05:21:29 UTC (rev 1005)
@@ -6,7 +6,6 @@
 #define OpenFDM_MechanicLinkValue_H
 
 #include &quot;CoordinateSystem.h&quot;
-#include &quot;Frame.h&quot;
 #include &quot;Inertia.h&quot;
 #include &quot;PortValue.h&quot;
 
@@ -17,10 +16,9 @@
   MechanicLinkValue();
   virtual ~MechanicLinkValue();
 
-  virtual MechanicLinkValue* toMechanicLinkValue() { return this; }
-  virtual const MechanicLinkValue* toMechanicLinkValue() const { return this; }
+  virtual MechanicLinkValue* toMechanicLinkValue();
+  virtual const MechanicLinkValue* toMechanicLinkValue() const;
 
-  /// Currently duplicate information from the Frame.
   /// This is an attempt to seperate the coordinate system stuff away from
   /// the reference frame handling.
   const CoordinateSystem&amp; getCoordinateSystem() const
@@ -63,63 +61,67 @@
   getRelativeCoordinateSystem(const MechanicLinkValue&amp; link) const
   { return mCoordinateSystem.toLocal(link.mCoordinateSystem); }
 
-  /// Returns the velocity of the link measured in this links coordinate
-  /// system and measured in this links reference frame
-  Vector6 getRelativeVelocity(const MechanicLinkValue&amp; link) const
-  {
-    CoordinateSystem csys = getRelativeCoordinateSystem(link);
-    return csys.motionToReference(link.getSpVel()) - getSpVel();
-  }
+  void setLocalVelocity(const Vector6&amp; velocity)
+  { mVelocity = mCoordinateSystem.rotToReference(velocity); }
+  Vector6 getLocalVelocity() const
+  { return mCoordinateSystem.rotToLocal(mVelocity); }
 
+  void setLocalAcceleration(const Vector6&amp; acceleration)
+  { mAcceleration = mCoordinateSystem.rotToReference(acceleration); }
+  Vector6 getLocalAcceleration() const
+  { return mCoordinateSystem.rotToLocal(mAcceleration); }
 
-//   const Vector6&amp; getSpVel() const
-  Vector6 getSpVel() const
-  { return mFrame.getSpVel(); }
-//   const Vector6&amp; getSpAccel() const
-  Vector6 getSpAccel() const
-  { return mFrame.getSpAccel(); }
 
+  void setVelocity(const Vector6&amp; velocity)
+  { mVelocity = velocity; }
+  const Vector6&amp; getVelocity() const
+  { return mVelocity; }
 
+  void setAcceleration(const Vector6&amp; acceleration)
+  { mAcceleration = acceleration; }
+  const Vector6&amp; getAcceleration() const
+  { return mAcceleration; }
 
 
-  void setPosAndVel(const MechanicLinkValue&amp; linkValue, const Vector3&amp; position,
-                    const Quaternion&amp; orientation, const Vector6&amp; velocity)
+  void setRelativeVelocity(const MechanicLinkValue&amp; linkValue,
+                           const Vector6&amp; velocity)
   {
     mArticulatedInertia = SpatialInertia::zeros();
     mArticulatedForce = Vector6::zeros();
-    mFrame.setPosAndVel(linkValue.mFrame, position, orientation, velocity);
+
+    Vector3 positionDiff = mCoordinateSystem.getPosition();
+    positionDiff -= linkValue.mCoordinateSystem.getPosition();
+    Vector6 parentVel = motionTo(positionDiff, linkValue.mVelocity);
+    mVelocity = mCoordinateSystem.rotToReference(velocity) + parentVel;
   }
-  void setAccel(const MechanicLinkValue&amp; linkValue, const Vector6&amp; accel)
-  { mFrame.setAccel(linkValue.mFrame, accel); }
-  void setPosAndVel(const Vector3&amp; parentAngularVel, const Vector3&amp; position,
-                    const Quaternion&amp; orientation, const Vector6&amp; velocity)
+  void setBaseVelocity(const Vector3&amp; baseAngularVel, const Vector6&amp; velocity)
   {
     mArticulatedInertia = SpatialInertia::zeros();
     mArticulatedForce = Vector6::zeros();
-    mFrame.setPosAndVel(parentAngularVel, position, orientation, velocity);
+
+    Vector3 referencePos = mCoordinateSystem.getPosition();
+    Vector6 parentVel = angularMotionTo(referencePos, baseAngularVel);
+    mVelocity = mCoordinateSystem.rotToReference(velocity) + parentVel;
   }
-  void setSpAccel(const Vector6&amp; accel)
-  { mFrame.setSpAccel(accel); }
 
-  Vector6 getRelVelDot() const
-  { return mFrame.getRelVelDot(); }
-
   const Vector3&amp; getDesignPosition() const
   { return mDesignPosition; }
   void setDesignPosition(const Vector3&amp; designPosition)
   { mDesignPosition = designPosition; }
 
-  /// Returns the spatial reference velocity at the local position
-  Vector6 getReferenceVelocity(const Vector3&amp; position) const
-  { return motionTo(position, mFrame.getRefVel()); }
-  Vector6 getReferenceVelocity() const
-  { return mFrame.getRefVel(); }
-
 protected:
   /// The local coordinate system of the mechanic link.
   CoordinateSystem mCoordinateSystem;
 
-  Frame mFrame;
+  /// The spatial velocity at the origin of the coordinate system
+  /// measured in global coordinate systems coordinates.
+  /// The spacial velocities pivot point is at the coordinate systems origin.
+  Vector6 mVelocity;
+  /// The spatial acceleration at the origin of the coordinate system
+  /// measured in global coordinate systems coordinates.
+  /// The spacial velocities pivot point is at the coordinate systems origin.
+  Vector6 mAcceleration;
+
   Vector6 mArticulatedForce;
   SpatialInertia mArticulatedInertia;
 
@@ -170,31 +172,26 @@
     return mMechanicLinkValue-&gt;getCoordinateSystem().getOrientation();
   }
 
-  Vector6 getSpVelAtLink() const
+  Vector6 getLocalVelocityAtLink() const
   {
     OpenFDMAssert(isConnected());
-    return mMechanicLinkValue-&gt;getSpVel();
+    return mMechanicLinkValue-&gt;getLocalVelocity();
   }
-  Vector6 getSpAccelAtLink() const
+  Vector6 getLocalAccelerationAtLink() const
   {
     OpenFDMAssert(isConnected());
-    return mMechanicLinkValue-&gt;getSpAccel();
+    return mMechanicLinkValue-&gt;getLocalAcceleration();
   }
-  Vector6 getSpVel() const
+  Vector6 getLocalVelocity() const
   {
     OpenFDMAssert(isConnected());
-    return motionTo(mLinkRelPos, mMechanicLinkValue-&gt;getSpVel());
+    return motionTo(mLinkRelPos, mMechanicLinkValue-&gt;getLocalVelocity());
   }
-  Vector6 getRefVel() const
+  Vector6 getLocalAcceleration() const
   {
     OpenFDMAssert(isConnected());
-    return mMechanicLinkValue-&gt;getReferenceVelocity(mLinkRelPos);
+    return motionTo(mLinkRelPos, mMechanicLinkValue-&gt;getLocalAcceleration());
   }
-  Vector6 getSpAccel() const
-  {
-    OpenFDMAssert(isConnected());
-    return motionTo(mLinkRelPos, mMechanicLinkValue-&gt;getSpAccel());
-  }
 
   void setDesignPosition(const Vector3&amp; position)
   {
@@ -287,54 +284,35 @@
   void setDesignPosition(const Vector3&amp; position)
   { mMechanicLinkValue-&gt;setDesignPosition(position); }
 
-  void setPosAndVel(const Vector3&amp; angularBaseVel, const Vector3&amp; position,
-                    const Quaternion&amp; orientation, const Vector6&amp; velocity)
-  {
-    mMechanicLinkValue-&gt;setPosAndVel(angularBaseVel, position,
-                                     orientation, velocity);
-  }
-  void setSpAccel(const Vector6&amp; accel)
-  {
-    mMechanicLinkValue-&gt;setSpAccel(accel);
-  }
-  Vector6 getSpAccel() const
-  {
-    return mMechanicLinkValue-&gt;getSpAccel();
-  }
+  void setLocalAcceleration(const Vector6&amp; accel)
+  { mMechanicLinkValue-&gt;setLocalAcceleration(accel); }
+  Vector6 getLocalAcceleration() const
+  { return mMechanicLinkValue-&gt;getLocalAcceleration(); }
 
-  void setPosAndVel(const ParentLink&amp; parentLink, const Vector3&amp; position,
-                    const Quaternion&amp; orientation, const Vector6&amp; velocity)
+  void setAcceleration(const Vector6&amp; accel)
+  { mMechanicLinkValue-&gt;setAcceleration(accel); }
+  const Vector6&amp; getAcceleration() const
+  { return mMechanicLinkValue-&gt;getAcceleration(); }
+
+  void setBaseVelocity(const Vector3&amp; angularBaseVel, const Vector6&amp; velocity)
+  { mMechanicLinkValue-&gt;setBaseVelocity(angularBaseVel, velocity); }
+
+  void setRelativeVelocity(const ParentLink&amp; parentLink,
+                           const Vector6&amp; velocity)
   {
     const MechanicLinkValue&amp; link = parentLink.getMechanicLinkValue();
-    mMechanicLinkValue-&gt;setPosAndVel(link, position, orientation, velocity);
+    mMechanicLinkValue-&gt;setRelativeVelocity(link, velocity);
   }
-  void setAccel(const ParentLink&amp; parentLink, const Vector6&amp; accel)
-  {
-    const MechanicLinkValue&amp; link = parentLink.getMechanicLinkValue();
-    mMechanicLinkValue-&gt;setAccel(link, accel);
-  }
 
   void setCoordinateSystem(const CoordinateSystem&amp; coordinateSystem)
-  {
-    OpenFDMAssert(mMechanicLinkValue);
-    return mMechanicLinkValue-&gt;setCoordinateSystem(coordinateSystem);
-  }
+  { return mMechanicLinkValue-&gt;setCoordinateSystem(coordinateSystem); }
   const CoordinateSystem&amp; getCoordinateSystem() const
-  {
-    OpenFDMAssert(mMechanicLinkValue);
-    return mMechanicLinkValue-&gt;getCoordinateSystem();
-  }
+  { return mMechanicLinkValue-&gt;getCoordinateSystem(); }
 
   const Vector6&amp; getForce() const
-  {
-    OpenFDMAssert(mMechanicLinkValue);
-    return mMechanicLinkValue-&gt;getForce();
-  }
+  { return mMechanicLinkValue-&gt;getForce(); }
   const SpatialInertia&amp; getInertia() const
-  {
-    OpenFDMAssert(mMechanicLinkValue);
-    return mMechanicLinkValue-&gt;getInertia();
-  }
+  { return mMechanicLinkValue-&gt;getInertia(); }
  
 private:
   SharedPtr&lt;MechanicLinkValue&gt; mMechanicLinkValue;

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/MobileRootJoint.cpp
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/MobileRootJoint.cpp	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/MobileRootJoint.cpp	2009-07-15 05:21:29 UTC (rev 1005)
@@ -52,7 +52,7 @@
     SpatialInertia inertia = mChildLink.getInertia();
     Vector6 force = -mChildLink.getForce();
     Vector6 spatialAcceleration = solve(inertia, force);
-    mChildLink.setSpAccel(spatialAcceleration);
+    mChildLink.setLocalAcceleration(spatialAcceleration);
   }
   
   virtual void derivative(const Task&amp; task)
@@ -179,7 +179,7 @@
   Vector6 velocity = continousState[*mVelocityStateInfo];
 
   childLink.setCoordinateSystem(CoordinateSystem(position, orientation));
-  childLink.setPosAndVel(angularBaseVelocity, position, orientation, velocity);
+  childLink.setBaseVelocity(angularBaseVelocity, velocity);
 }
 
 void
@@ -219,7 +219,7 @@
                          cross(pivel.getAngular(), relVel.getLinear()) + 
                          cross(pivel.getLinear(), relVel.getAngular()));
 
-  Vector6 velDeriv = childLink.getSpAccel() - spatialAcceleration - Hdot;
+  Vector6 velDeriv = childLink.getLocalAcceleration() - spatialAcceleration - Hdot;
 
   derivatives[*mPositionStateInfo] = pDot;
   derivatives[*mOrientationStateInfo] = qderiv;

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/PacejkaTire.cpp
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/PacejkaTire.cpp	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/PacejkaTire.cpp	2009-07-15 05:21:29 UTC (rev 1005)
@@ -91,7 +91,7 @@
     // The relative velocity of the wheel wrt the contact surface
     // measured in the hubs coordinate system.
     // This includes the wheels revolution speed.
-    Vector6 relVel = getLink().getRefVel() - groundValues.vel;
+    Vector6 relVel = getLink().getLocalVelocity() - groundValues.vel;
 
     // The compression velocity.
     // Positive when the contact spring is compressed,

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/Tailhook.cpp
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/Tailhook.cpp	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/Tailhook.cpp	2009-07-15 05:21:29 UTC (rev 1005)
@@ -8,7 +8,6 @@
 #include &quot;LogStream.h&quot;
 #include &quot;Object.h&quot;
 #include &quot;Vector.h&quot;
-#include &quot;Frame.h&quot;
 #include &quot;Force.h&quot;
 
 namespace OpenFDM {

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/Tailhook.h
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/Tailhook.h	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/Tailhook.h	2009-07-15 05:21:29 UTC (rev 1005)
@@ -8,7 +8,6 @@
 #include &quot;Assert.h&quot;
 #include &quot;Object.h&quot;
 #include &quot;Vector.h&quot;
-#include &quot;Frame.h&quot;
 #include &quot;Force.h&quot;
 #include &quot;Ground.h&quot;
 #include &quot;Environment.h&quot;

Modified: branches/OpenFDM-StateSeparation/src/OpenFDM/WheelContact.cpp
===================================================================
--- branches/OpenFDM-StateSeparation/src/OpenFDM/WheelContact.cpp	2009-07-13 18:45:50 UTC (rev 1004)
+++ branches/OpenFDM-StateSeparation/src/OpenFDM/WheelContact.cpp	2009-07-15 05:21:29 UTC (rev 1005)
@@ -56,7 +56,7 @@
     Vector3 contactPoint = distHubGround*down;
     
     // The relative velocity of the ground wrt the contact point
-    Vector6 relVel = getLink().getRefVel() - groundValues.vel;
+    Vector6 relVel = getLink().getLocalVelocity() - groundValues.vel;
     
     // The velocity perpandicular to the plane.
     // Positive when the contact spring is compressed,


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000967.html">[OpenFDM-svn] r1004 - branches/OpenFDM-StateSeparation/src/OpenFDM
</A></li>
	<LI>Next message: <A HREF="000968.html">[OpenFDM-svn] r1006 - branches/OpenFDM-StateSeparation/src/OpenFDM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#983">[ date ]</a>
              <a href="thread.html#983">[ thread ]</a>
              <a href="subject.html#983">[ subject ]</a>
              <a href="author.html#983">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openfdm-svn">More information about the OpenFDM-svn
mailing list</a><br>
</body></html>
